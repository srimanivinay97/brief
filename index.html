<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Brief</title>

  <style>
    :root{
      --bg1:#05060a;
      --bg2:#0b0f1f;
      --card: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --muted2: rgba(255,255,255,.45);
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 22px;
      --pad: 18px;
      --gap: 14px;
      --chip: rgba(255,255,255,.12);
      --good: rgba(70,255,170,.18);
      --warn: rgba(255,210,90,.18);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(900px 700px at 20% 8%, rgba(120,110,255,.18), transparent 55%),
        radial-gradient(900px 700px at 85% 22%, rgba(0,190,255,.14), transparent 55%),
        radial-gradient(900px 700px at 70% 90%, rgba(255,120,200,.12), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      padding: 22px 16px 40px;
    }

    .wrap{ max-width: 560px; margin: 0 auto; }

    header{
      display:flex; align-items:flex-end; justify-content:space-between;
      margin: 6px 2px 14px;
    }
    .title{
      font-weight: 780;
      letter-spacing: -0.02em;
      font-size: 40px;
      line-height: 1;
    }
    .sub{
      font-size: 12px;
      color: var(--muted2);
      margin-top: 6px;
    }

    .stack{ display:grid; gap: var(--gap); }

    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      padding: var(--pad);
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      overflow:hidden;
      position:relative;
    }

    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(600px 200px at 12% 0%, rgba(255,255,255,.10), transparent 55%);
      pointer-events:none;
    }

    .row{ display:flex; align-items:center; justify-content:space-between; gap: 10px; }
    .label{ font-size: 12px; color: var(--muted2); letter-spacing:.08em; text-transform: uppercase; }
    .value{ font-size: 14px; color: var(--muted); }

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: var(--chip);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--text);
      font-size: 13px;
      width: fit-content;
    }

    .status{
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
    }
    .badge{
      padding: 7px 12px;
      border-radius: 999px;
      font-size: 13px;
      border: 1px solid rgba(255,255,255,.12);
      background: var(--good);
      color: rgba(190,255,225,.95);
    }

    .weatherTop{ display:flex; align-items:flex-end; justify-content:space-between; gap: 12px; }
    .temp{
      font-size: 72px;
      font-weight: 820;
      letter-spacing: -0.05em;
      line-height: .9;
      margin: 8px 0 6px;
    }
    .meta{
      display:flex; flex-direction:column; gap:6px;
      align-items:flex-end;
      text-align:right;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 14px;
    }
    .mini{
      padding: 12px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .mini .k{ font-size:12px; color: var(--muted2); }
    .mini .v{ margin-top:6px; font-size:15px; color: var(--text); font-weight: 650; }

    .sectionTitle{
      display:flex; align-items:center; gap:10px;
      margin-bottom: 10px;
    }
    .icon{
      width: 34px; height: 34px;
      border-radius: 12px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.12);
      font-size: 18px;
    }
    .sectionTitle h3{
      margin:0;
      font-size: 16px;
      letter-spacing: -.01em;
    }

    ul.clean{
      list-style:none;
      padding:0; margin: 10px 0 0;
      display:grid; gap: 10px;
    }
    .item{
      padding: 12px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      display:flex; align-items:flex-start; justify-content:space-between; gap: 12px;
    }
    .item .left{ display:flex; flex-direction:column; gap:4px; }
    .item .t{ font-weight: 700; }
    .item .d{ font-size: 13px; color: var(--muted); }
    .item .r{ font-size: 13px; color: var(--muted2); white-space:nowrap; }

    .mutedBlock{
      font-size: 13px;
      color: var(--muted);
      line-height: 1.45;
    }

    .toggleRow{
      display:flex; align-items:center; justify-content:space-between;
      margin-top: 10px;
      gap: 12px;
    }
    .btn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 13px;
    }
    pre{
      margin: 10px 0 0;
      padding: 14px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      overflow:auto;
      font-size: 12px;
      color: rgba(255,255,255,.80);
      display:none;
    }

    /* small phones */
    @media (max-width: 380px){
      .temp{ font-size: 62px; }
      .title{ font-size: 36px; }
      .grid2{ grid-template-columns: 1fr; }
      .meta{ align-items:flex-start; text-align:left; }
      .weatherTop{ align-items:flex-start; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">Brief</div>
        <div class="sub" id="updatedText">Waiting for data‚Ä¶</div>
      </div>
      <div class="chip" id="locationChip">üìç Location</div>
    </header>

    <div class="stack">

      <!-- Status -->
      <div class="card">
        <div class="status">
          <div>
            <div class="label">Status</div>
            <div class="value" id="statusText">Open with <b>?data=BASE64</b></div>
          </div>
          <div class="badge" id="statusBadge">Waiting</div>
        </div>

        <div class="toggleRow">
          <div class="mutedBlock">Tip: use URL-encoded Base64 for best reliability.</div>
          <button class="btn" id="toggleDebug">Show Debug</button>
        </div>
        <pre id="debugPre"></pre>
      </div>

      <!-- Weather -->
      <div class="card">
        <div class="sectionTitle">
          <div class="icon">‚õÖÔ∏è</div>
          <h3>Weather</h3>
        </div>

        <div class="weatherTop">
          <div>
            <div class="label" id="weatherLabel">‚Äî</div>
            <div class="temp" id="tempText">--¬∞</div>
            <div class="chip" id="conditionChip">‚Äî</div>
          </div>

          <div class="meta">
            <div class="chip" id="feelsChip">üå°Ô∏è Feels like ‚Äî</div>
            <div class="chip" id="windChip">üí® Wind ‚Äî</div>
          </div>
        </div>

        <div class="grid2">
          <div class="mini">
            <div class="k">Humidity</div>
            <div class="v" id="humidityText">‚Äî</div>
          </div>
          <div class="mini">
            <div class="k">Rain chance</div>
            <div class="v" id="rainText">‚Äî</div>
          </div>
        </div>
      </div>

      <!-- Events -->
      <div class="card">
        <div class="sectionTitle">
          <div class="icon">üìÖ</div>
          <h3>Today</h3>
        </div>

        <div class="mutedBlock" id="eventsEmpty">No events added yet.</div>
        <ul class="clean" id="eventsList"></ul>
      </div>

      <!-- Health -->
      <div class="card">
        <div class="sectionTitle">
          <div class="icon">‚ù§Ô∏è</div>
          <h3>Health</h3>
        </div>

        <div class="mutedBlock" id="healthEmpty">No health summary provided.</div>
        <ul class="clean" id="healthList"></ul>
      </div>

    </div>
  </div>

<script>
  function safeParseData() {
    const params = new URLSearchParams(window.location.search);
    const encoded = params.get("data");
    if (!encoded) return null;

    // encoded may already be URL-encoded; decode safely
    const decodedURIComponent = decodeURIComponent(encoded);

    // Base64 decode
    const jsonText = atob(decodedURIComponent);

    // JSON parse
    return JSON.parse(jsonText);
  }

  function setText(id, text){ const el = document.getElementById(id); if (el) el.textContent = text; }
  function setHTML(id, html){ const el = document.getElementById(id); if (el) el.innerHTML = html; }

  const debugPre = document.getElementById("debugPre");
  const toggleDebug = document.getElementById("toggleDebug");
  let debugVisible = false;

  toggleDebug.addEventListener("click", () => {
    debugVisible = !debugVisible;
    debugPre.style.display = debugVisible ? "block" : "none";
    toggleDebug.textContent = debugVisible ? "Hide Debug" : "Show Debug";
  });

  try{
    const data = safeParseData();
    if (!data){
      setText("statusText", "Open with ?data=BASE64");
      setText("statusBadge", "Waiting");
      return;
    }

    // Status
    setHTML("statusText", "Data received and parsed.");
    document.getElementById("statusBadge").textContent = "OK";

    // Top
    setText("updatedText", data.updatedAt ? `Updated ‚Ä¢ ${data.updatedAt}` : "Updated ‚Ä¢ now");
    setText("locationChip", `üìç ${data.location || "Location"}`);

    // Debug
    debugPre.textContent = JSON.stringify(data, null, 2);

    // Weather
    const w = data.weather || {};
    setText("weatherLabel", `Weather ‚Ä¢ ${data.location || "‚Äî"}`);
    setText("tempText", w.tempC || "--¬∞");
    setText("conditionChip", w.condition || "‚Äî");
    setText("feelsChip", `üå°Ô∏è Feels like ${w.feelsLike || "‚Äî"}`);
    setText("windChip", `üí® Wind ${w.wind || "‚Äî"}`);
    setText("humidityText", w.humidity || "‚Äî");
    setText("rainText", w.rainChance || "‚Äî");

    // Events: supports string OR array
    const eventsList = document.getElementById("eventsList");
    const eventsEmpty = document.getElementById("eventsEmpty");
    const events = data.events;

    function addItem(listEl, title, desc, right){
      const li = document.createElement("li");
      li.className = "item";
      li.innerHTML = `
        <div class="left">
          <div class="t">${title || "‚Äî"}</div>
          ${desc ? `<div class="d">${desc}</div>` : ``}
        </div>
        ${right ? `<div class="r">${right}</div>` : ``}
      `;
      listEl.appendChild(li);
    }

    if (Array.isArray(events) && events.length){
      eventsEmpty.style.display = "none";
      events.forEach(e => addItem(eventsList, e.title, e.note || e.location || "", e.time || ""));
    } else if (typeof events === "string" && events.trim()){
      eventsEmpty.style.display = "none";
      addItem(eventsList, "Event", events.trim(), "");
    } else {
      eventsEmpty.style.display = "block";
    }

    // Health: supports object summary OR array items
    const healthList = document.getElementById("healthList");
    const healthEmpty = document.getElementById("healthEmpty");
    const h = data.health;

    if (Array.isArray(h) && h.length){
      healthEmpty.style.display = "none";
      h.forEach(x => addItem(healthList, x.title, x.value || x.note || "", x.badge || ""));
    } else if (h && typeof h === "object"){
      healthEmpty.style.display = "none";
      // common keys
      if (h.steps) addItem(healthList, "Steps", String(h.steps), "üö∂");
      if (h.sleep) addItem(healthList, "Sleep", String(h.sleep), "üò¥");
      if (h.heartRate) addItem(healthList, "Heart Rate", String(h.heartRate), "‚ù§Ô∏è");
      if (h.note) addItem(healthList, "Note", String(h.note), "");
      // if empty object
      if (!Object.keys(h).length) healthEmpty.style.display = "block";
    } else if (typeof h === "string" && h.trim()){
      healthEmpty.style.display = "none";
      addItem(healthList, "Summary", h.trim(), "‚ù§Ô∏è");
    } else {
      healthEmpty.style.display = "block";
    }

  } catch(err){
    setHTML("statusText", "Could not parse data. Check Base64 + URL encoding.");
    document.getElementById("statusBadge").textContent = "Error";
    debugPre.textContent = String(err);
    debugPre.style.display = "block";
    toggleDebug.textContent = "Hide Debug";
  }
</script>
</body>
</html>
